<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Home · PokerHandEvaluator.jl</title><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="assets/documenter.js"></script><script src="siteinfo.js"></script><script src="../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit">PokerHandEvaluator.jl</span></div><form class="docs-search" action="search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li class="is-active"><a class="tocitem" href>Home</a><ul class="internal"><li><a class="tocitem" href="#Cactus-Kev-approach"><span>Cactus Kev approach</span></a></li><li><a class="tocitem" href="#PokerHandEvaluator.jl&#39;s-implementation"><span>PokerHandEvaluator.jl&#39;s implementation</span></a></li></ul></li><li><a class="tocitem" href="api/">API</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Home</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Home</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/charleskawczynski/PokerHandEvaluator.jl/blob/master/docs/src/index.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="PokerHandEvaluator.jl"><a class="docs-heading-anchor" href="#PokerHandEvaluator.jl">PokerHandEvaluator.jl</a><a id="PokerHandEvaluator.jl-1"></a><a class="docs-heading-anchor-permalink" href="#PokerHandEvaluator.jl" title="Permalink"></a></h1><p>A package for evaluating poker hands. PokerHandEvaluator.jl broadly uses the <a href="http://suffe.cool/poker/evaluator.html">Cactus Kev</a> approach (described in the next section) to evaluate hand ranks.</p><h2 id="Cactus-Kev-approach"><a class="docs-heading-anchor" href="#Cactus-Kev-approach">Cactus Kev approach</a><a id="Cactus-Kev-approach-1"></a><a class="docs-heading-anchor-permalink" href="#Cactus-Kev-approach" title="Permalink"></a></h2><p>There are <code>combinations(52,5)</code>, or 2,598,960, unique 5-card hands. However, many of these hands have the exact same rank (e.g., (A♡,A♢,K♣,K♠,3♢) and (A♣,A♠,K♡,K♢,3♡)). There are 7462 unique <em>hand ranks</em> defined as</p><ul><li>A K Q J 10 royal straight flush: <code>hand_rank = 1</code></li><li>K Q J 10 9 straight flush: <code>hand_rank = 2</code></li><li>...</li><li>7 5 4 3 2: <code>hand_rank = 7462</code></li></ul><p>That&#39;s the gist of it. There&#39;s one more aspect to be addressed, and that is how to make the input arguments order-agnostic (to avoid sorting input arguments). To make the <code>hand_rank</code> order-agnostic, the card rank of each input can be mapped to prime numbers, and the product of these prime numbers are (1) unique (the product of unique primes is unique) and (2) order-agnostic (due to the multiplication commutative property). This mapped relationship can be implemented in various ways, for example via lookup tables, binary search etc.</p><h2 id="PokerHandEvaluator.jl&#39;s-implementation"><a class="docs-heading-anchor" href="#PokerHandEvaluator.jl&#39;s-implementation">PokerHandEvaluator.jl&#39;s implementation</a><a id="PokerHandEvaluator.jl&#39;s-implementation-1"></a><a class="docs-heading-anchor-permalink" href="#PokerHandEvaluator.jl&#39;s-implementation" title="Permalink"></a></h2><p>PokerHandEvaluator.jl uses <a href="https://github.com/charleskawczynski/PlayingCards.jl">PlayingCards.jl</a> and defines <code>hand_rank</code> for a <code>Tuple</code> of 5 <a href="https://github.com/charleskawczynski/PlayingCards.jl#cards"><code>Card</code></a>s. The <code>hand_rank</code> wrapper first uses (specialized) dispatch on flush vs off-suited hands which calls <code>hand_rank_flush</code> and <code>hand_rank_offsuit</code>. There are 1287 <code>hand_rank_flush</code> methods and 7462 - 1287 = 6175 <code>hand_rank_offsuit</code> methods. <code>hand_rank_flush</code> and <code>hand_rank_offsuit</code> methods are defined via <code>Val</code> for the mapped product of primes for the given card combination:</p><ul><li><code>hand_rank_offsuit(::Val{prod(prime.(cards))}) = N</code></li><li><code>hand_rank_flush(::Val{prod(prime.(cards))}) = N</code></li></ul><p>PokerHandEvaluator.jl simply loops over the combinations of hands (using <a href="https://github.com/JuliaMath/Combinatorics.jl">Combinatorics.jl</a>) and <code>eval</code>-ing the methods into the module to return the value directly:</p><pre><code class="language-julia">using BenchmarkTools, InteractiveUtils
using PlayingCards, PokerHandEvaluator
@code_typed hand_rank((A♡, A♣, A♠, 3♡, 2♢))</code></pre><pre class="documenter-example-output">CodeInfo(
1 ─ %1  = Core.tuple(t)::Tuple{Tuple{PlayingCards.Card{PlayingCards.Heart}, PlayingCards.Card{PlayingCards.Club}, PlayingCards.Card{PlayingCards.Spade}, PlayingCards.Card{PlayingCards.Heart}, PlayingCards.Card{PlayingCards.Diamond}}}
│   %2  = %new(Base.Broadcast.Broadcasted{Base.Broadcast.Style{Tuple}, Nothing, typeof(PokerHandEvaluator.prime), Tuple{Tuple{PlayingCards.Card{PlayingCards.Heart}, PlayingCards.Card{PlayingCards.Club}, PlayingCards.Card{PlayingCards.Spade}, PlayingCards.Card{PlayingCards.Heart}, PlayingCards.Card{PlayingCards.Diamond}}}}, PokerHandEvaluator.prime, %1, nothing)::Base.Broadcast.Broadcasted{Base.Broadcast.Style{Tuple}, Nothing, typeof(PokerHandEvaluator.prime), Tuple{Tuple{PlayingCards.Card{PlayingCards.Heart}, PlayingCards.Card{PlayingCards.Club}, PlayingCards.Card{PlayingCards.Spade}, PlayingCards.Card{PlayingCards.Heart}, PlayingCards.Card{PlayingCards.Diamond}}}}
│   %3  = %new(Base.Broadcast.var&quot;#19#20&quot;{Base.Broadcast.Broadcasted{Base.Broadcast.Style{Tuple}, Nothing, typeof(PokerHandEvaluator.prime), Tuple{Tuple{PlayingCards.Card{PlayingCards.Heart}, PlayingCards.Card{PlayingCards.Club}, PlayingCards.Card{PlayingCards.Spade}, PlayingCards.Card{PlayingCards.Heart}, PlayingCards.Card{PlayingCards.Diamond}}}}}, %2)::Base.Broadcast.var&quot;#19#20&quot;{Base.Broadcast.Broadcasted{Base.Broadcast.Style{Tuple}, Nothing, typeof(PokerHandEvaluator.prime), Tuple{Tuple{PlayingCards.Card{PlayingCards.Heart}, PlayingCards.Card{PlayingCards.Club}, PlayingCards.Card{PlayingCards.Spade}, PlayingCards.Card{PlayingCards.Heart}, PlayingCards.Card{PlayingCards.Diamond}}}}}
│   %4  = invoke %3(1::Int64)::Any
│   %5  = invoke %3(2::Int64)::Any
│   %6  = invoke %3(3::Int64)::Any
│   %7  = invoke %3(4::Int64)::Any
│   %8  = invoke %3(5::Int64)::Any
│   %9  = Base.tuple(%4, %5, %6, %7, %8)::NTuple{5, Any}
│   %10 = PokerHandEvaluator.prod(%9)::Any
│   %11 = PokerHandEvaluator.Val(%10)::Val{_A} where _A
│   %12 = PokerHandEvaluator.hand_rank_offsuit(%11)::Any
└──       return %12
) =&gt; Any</pre><pre><code class="language-julia">@btime hand_rank($(A♡, A♣, A♠, 3♡, 2♢))
nothing</code></pre><pre class="documenter-example-output">  0.001 ns (0 allocations: 0 bytes)</pre><p>Doing this is very expensive for the compiler as there are many method definitions– hence why we precompile all of these methods so that the expense is paid up-front.</p></article><nav class="docs-footer"><a class="docs-footer-nextpage" href="api/">API »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> on <span class="colophon-date" title="Saturday 10 April 2021 22:03">Saturday 10 April 2021</span>. Using Julia version 1.6.0.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
